{"version":3,"sources":["tools/UpdateVersions.js"],"names":["async","updateSdkVersionsAsync","sdkVersion","reactNativeTag","facebookRNVersion","facebookReactVersion","let","versions","await","Versions","versionsAsync","sdkVersions","expoReactNativeTag","facebookReactNativeVersion","setVersionsAsync","updateIOSSimulatorBuild","s3Client","pathToApp","appVersion","tempAppPath","path","join","process","cwd","spawnAsync","stdio","file","fs","createReadStream","console","log","putObject","Bucket","Key","Body","ACL","promise","updateAndroidApk"],"mappings":"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","file":"../../tools/UpdateVersions.js","sourcesContent":["/**\n * @flow\n */\n\nimport fs from 'fs';\nimport path from 'path';\nimport spawnAsync from '@expo/spawn-async';\nimport _ from 'lodash';\nimport * as Versions from '../Versions';\n\nexport async function updateSdkVersionsAsync(\n  sdkVersion: string,\n  reactNativeTag: string,\n  facebookRNVersion: string,\n  facebookReactVersion: string\n) {\n  let versions = await Versions.versionsAsync();\n  versions.sdkVersions[sdkVersion] = {\n    ...versions.sdkVersions[sdkVersion],\n    expoReactNativeTag: reactNativeTag,\n    facebookReactNativeVersion: facebookRNVersion,\n    facebookReactVersion,\n  };\n  await Versions.setVersionsAsync(versions);\n}\n\nexport async function updateIOSSimulatorBuild(\n  s3Client: any,\n  pathToApp: string,\n  appVersion: string\n) {\n  let tempAppPath = path.join(process.cwd(), 'temp-app.tar.gz');\n\n  await spawnAsync('tar', ['-zcvf', tempAppPath, '-C', pathToApp, '.'], {\n    cwd: process.cwd(),\n    stdio: ['ignore', 'ignore', 'inherit'], // only stderr\n  });\n\n  let file = fs.createReadStream(tempAppPath);\n\n  console.log('Uploading...');\n\n  await s3Client\n    .putObject({\n      Bucket: 'exp-ios-simulator-apps',\n      Key: `Exponent-${appVersion}.tar.gz`,\n      Body: file,\n      ACL: 'public-read',\n    })\n    .promise();\n\n  await spawnAsync('rm', [tempAppPath]);\n\n  console.log('Adding to server config...');\n\n  let versions = await Versions.versionsAsync();\n  versions['iosVersion'] = appVersion;\n  versions['iosUrl'] = `https://dpq5q02fu5f55.cloudfront.net/Exponent-${appVersion}.tar.gz`;\n  await Versions.setVersionsAsync(versions);\n}\n\nexport async function updateAndroidApk(s3Client: any, pathToApp: string, appVersion: string) {\n  let file = fs.createReadStream(pathToApp);\n\n  console.log('Uploading...');\n\n  await s3Client\n    .putObject({\n      Bucket: 'exp-android-apks',\n      Key: `Exponent-${appVersion}.apk`,\n      Body: file,\n      ACL: 'public-read',\n    })\n    .promise();\n\n  console.log('Adding to server config...');\n\n  let versions = await Versions.versionsAsync();\n  versions['androidVersion'] = appVersion;\n  versions['androidUrl'] = `https://d1ahtucjixef4r.cloudfront.net/Exponent-${appVersion}.apk`;\n  await Versions.setVersionsAsync(versions);\n}\n"],"sourceRoot":"/@expo/xdl@55.0.14/src"}