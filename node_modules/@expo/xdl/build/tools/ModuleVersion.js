"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createModuleVersionChecker = createModuleVersionChecker;

var _latestVersion = _interopRequireDefault(require("latest-version"));

var _packageJson = _interopRequireDefault(require("package-json"));

var _pTimeout = _interopRequireDefault(require("p-timeout"));

var _semver = _interopRequireDefault(require("semver"));

var _FsCache = require("./FsCache");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function createModuleVersionChecker(name, currentVersion) {
  const UpdateCacher = new _FsCache.Cacher(async () => {
    const pkgJson = await (0, _packageJson.default)(name, {
      version: currentVersion
    });
    return {
      latestVersion: await (0, _pTimeout.default)((0, _latestVersion.default)(name), 2000),
      deprecated: pkgJson.deprecated
    };
  }, `${name}-updates.json`, 24 * 60 * 60 * 1000 // one day
  );

  async function checkAsync() {
    const {
      latestVersion,
      deprecated
    } = await UpdateCacher.getAsync();
    return {
      updateIsAvailable: _semver.default.gt(latestVersion, currentVersion),
      latest: latestVersion,
      current: currentVersion,
      deprecated
    };
  }

  return {
    checkAsync
  };
}
//# sourceMappingURL=../__sourcemaps__/tools/ModuleVersion.js.map
