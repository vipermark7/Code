{"version":3,"sources":["detach/installPackageAsync.js"],"names":["async","appPath","packageName","packageVersion","options","packageLockJsonExists","await","fs","pathExists","path","join","yarnExists","commandExists","useYarn","let","command","args","pkg","push","npmOrYarn","logger","info","spawnOpts","silent","stdio","spawnAsync","installPackageAsync"],"mappings":";;;;;;;;AAEA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;AACA;;;;AAEA;AAAA;AAAA;;;;;;;+BAQeA,WACbC,OADaD,EAEbE,WAFaF,EAGbG,cAHaH,EAIbI,UAAgB,EAJHJ,EAKW;AACxB,UAAMK,wBAAiCC,MAAMC,sCAAGC,UAAHD,CAC3CE,cAAKC,IAALD,CAAUR,OAAVQ,EAAmB,mBAAnBA,CAD2CF,CAA7C;AAGA,UAAMI,aAAaL,MAAMM,uDAAc,SAAdA,CAAzB;AACA,UAAMC,UAAUF,cAAc,CAACN,qBAA/B;;AAEAS,QAAIC,UAAU,EAAdD;AACAA,QAAIE,OAAO,EAAXF;;AAEA,QAAID,OAAJ,EAAa;AACXE,gBAAU,SAAVA;AACA,UAAIb,WAAJ,EAAiB;AACfc,eAAO,CAAC,KAAD,CAAPA;AACF;AACF,KALA,MAKO;AACLD,gBAAU,KAAVA;AACAC,aAAO,CAAC,SAAD,EAAY,QAAZ,CAAPA;AACF;;AAEAF,QAAIG,MAAMf,WAAVY;AACA,QAAIG,GAAJ,EAAS;AACP,UAAId,cAAJ,EAAoB;AAClBc,cAAO,GAAEA,GAAI,IAAGd,cAAe,EAA/Bc;AACF;;AAEAD,WAAKE,IAALF,CAAUC,GAAVD;AACF;;AAEA,UAAMG,YAAYN,UAAU,MAAVA,GAAmB,KAArC;AACAO,wCAAOC,IAAPD,CAAa,cAAaH,MAAMA,GAANA,GAAY,cAAe,UAASE,SAAU,KAAxEC;AACAA,wCAAOC,IAAPD;;AAEAN,QAAIQ,YAAY,EAAhBR;AACA,QAAIV,QAAQmB,MAAZ,EAAoB;AAClBD,gBAAUC,MAAVD,GAAmB,IAAnBA;AACF,KAFA,MAEO;AACLA,gBAAUE,KAAVF,GAAkB,SAAlBA;AACF;;AAEA,WAAOG,iDAAWV,OAAXU,EAAoBT,IAApBS,EAA0BH,SAA1BG,CAAP;AACF,G;;WA9C8BC,mB;;;;SAAAA,mB","file":"../../detach/installPackageAsync.js","sourcesContent":["// @flow\n\nimport spawnAsync from '@expo/spawn-async';\nimport commandExists from 'command-exists';\nimport fs from 'fs-extra';\nimport path from 'path';\n\nimport logger from './Logger';\n\ntype InstallResult = {\n  code: number,\n  command: string,\n  args: Array<string>,\n};\n\nexport default async function installPackageAsync(\n  appPath: string,\n  packageName?: string,\n  packageVersion?: string,\n  options?: any = {}\n): Promise<InstallResult> {\n  const packageLockJsonExists: boolean = await fs.pathExists(\n    path.join(appPath, 'package-lock.json')\n  );\n  const yarnExists = await commandExists('yarnpkg');\n  const useYarn = yarnExists && !packageLockJsonExists;\n\n  let command = '';\n  let args = [];\n\n  if (useYarn) {\n    command = 'yarnpkg';\n    if (packageName) {\n      args = ['add'];\n    }\n  } else {\n    command = 'npm';\n    args = ['install', '--save'];\n  }\n\n  let pkg = packageName;\n  if (pkg) {\n    if (packageVersion) {\n      pkg = `${pkg}@${packageVersion}`;\n    }\n\n    args.push(pkg);\n  }\n\n  const npmOrYarn = useYarn ? 'yarn' : 'npm';\n  logger.info(`Installing ${pkg ? pkg : 'dependencies'} using ${npmOrYarn}...`);\n  logger.info();\n\n  let spawnOpts = {};\n  if (options.silent) {\n    spawnOpts.silent = true;\n  } else {\n    spawnOpts.stdio = 'inherit';\n  }\n\n  return spawnAsync(command, args, spawnOpts);\n}\n"],"sourceRoot":"/xdl@52.0.12/src"}