{"version":3,"sources":["Exp.js"],"names":["async","root","let","exp","pkg","await","ProjectUtils","readConfigJsonAsync","entryPoint","main","determineEntryPointAsync","templateSpec","name","projectRoot","packageManager","Logger","notifications","info","code","NotificationCode","PROGRESS","MessageCode","EXTRACTING","pacote","extract","cache","path","join","UserSettings","dotExpoHomeDirectory","CUSTOMIZING","appFile","appJson","readAsync","expo","slug","writeAsync","packageFile","packageJson","private","version","description","tags","repository","_resolved","_integrity","_from","fs","move","error","data","readFileSync","appendFileSync","unlinkSync","initGitRepo","installDependencies","extractTemplateApp","process","platform","Binaries","isXcodeInstalled","global","warn","insideGit","spawnAsync","cwd","debug","e","stdio","resolve","recentExpsJsonFile","recentExps","filter","x","unshift","slice","saveRecentExpRootAsync","icon","iconUrl","pathOrUrl","resolvedPath","existsSync","readableRoot","makePathReadable","expInfoSafeAsync","publicUrl","user","UserManager","ensureLoggedInAsync","Error","username","ThirdParty","getManifest","sdkVersion","bundleIdentifierIOS","ios","bundleIdentifier","args","remoteUsername","remotePackageName","remoteFullPackageName","getThirdPartyInfoAsync","configName","configFilenameAsync","getPublishInfoAsync","results","Promise","all","map","filteredResults","result","recentValidExpsAsync","recipient","url_","allowUnauthed","Api","callMethodAsync","sendAsync","ps","ProjectSettings","randomness","urlRandomness","resetProjectRandomnessAsync","getProjectRandomnessAsync","UrlUtils","someRandomness","setAsync","rimraf","sync","clearXDLCacheAsync","default","ENTRY_POINT_PLATFORM_TEMPLATE_STRING","getHomeDir","env","pth","homedir","substr","length"],"mappings":"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","file":"../Exp.js","sourcesContent":["/**\n * @flow\n */\n\nimport fs from 'fs-extra';\nimport path from 'path';\nimport spawnAsync from '@expo/spawn-async';\nimport JsonFile from '@expo/json-file';\nimport rimraf from 'rimraf';\nimport pacote from 'pacote';\n\nimport * as Analytics from './Analytics';\nimport Api from './Api';\nimport * as Binaries from './Binaries';\nimport ErrorCode from './ErrorCode';\nimport * as Extract from './Extract';\nimport Logger from './Logger';\nimport NotificationCode from './NotificationCode';\nimport * as ProjectUtils from './project/ProjectUtils';\nimport * as ThirdParty from './ThirdParty';\nimport UserManager from './User';\nimport * as UrlUtils from './UrlUtils';\nimport UserSettings from './UserSettings';\nimport XDLError from './XDLError';\nimport * as ProjectSettings from './ProjectSettings';\nimport MessageCode from './MessageCode';\n\n// FIXME(perry) eliminate usage of this template\nexport const ENTRY_POINT_PLATFORM_TEMPLATE_STRING = 'PLATFORM_GOES_HERE';\n\nexport { default as convertProjectAsync } from './project/Convert';\n\nexport async function determineEntryPointAsync(root: string) {\n  let { exp, pkg } = await ProjectUtils.readConfigJsonAsync(root);\n\n  // entryPoint is relative to the packager root and main is relative\n  // to the project root. So if your rn-cli.config.js points to a different\n  // root than the project root, these can be different. Most of the time\n  // you should use main.\n  let entryPoint = pkg.main || 'index.js';\n  if (exp && exp.entryPoint) {\n    entryPoint = exp.entryPoint;\n  }\n\n  return entryPoint;\n}\n\nexport async function extractTemplateApp(\n  templateSpec: string | object,\n  name: string,\n  projectRoot: string,\n  packageManager: 'yarn' | 'npm' = 'npm'\n) {\n  Logger.notifications.info({ code: NotificationCode.PROGRESS }, MessageCode.EXTRACTING);\n  await pacote.extract(templateSpec, projectRoot, {\n    cache: path.join(UserSettings.dotExpoHomeDirectory(), 'template-cache'),\n  });\n\n  // Update files\n  Logger.notifications.info({ code: NotificationCode.PROGRESS }, MessageCode.CUSTOMIZING);\n\n  let appFile = new JsonFile(path.join(projectRoot, 'app.json'));\n  let appJson = await appFile.readAsync();\n  appJson = {\n    ...appJson,\n    expo: { ...appJson.expo, name, slug: name },\n  };\n  await appFile.writeAsync(appJson);\n\n  let packageFile = new JsonFile(path.join(projectRoot, 'package.json'));\n  let packageJson = await packageFile.readAsync();\n  // Adding `private` stops npm from complaining about missing `name` and `version` fields.\n  // We don't add a `name` field because it also exists in `app.json`.\n  packageJson = { ...packageJson, private: true };\n  // These are metadata fields related to the template package, let's remove them from the package.json.\n  delete packageJson.name;\n  delete packageJson.version;\n  delete packageJson.description;\n  delete packageJson.tags;\n  delete packageJson.repository;\n  // pacote adds these, but we don't want them in the package.json of the project.\n  delete packageJson._resolved;\n  delete packageJson._integrity;\n  delete packageJson._from;\n  await packageFile.writeAsync(packageJson);\n\n  // Rename `gitignore` because npm ignores files named `.gitignore` when publishing.\n  // See: https://github.com/npm/npm/issues/1862\n  try {\n    await fs.move(path.join(projectRoot, 'gitignore'), path.join(projectRoot, '.gitignore'));\n  } catch (error) {\n    // Append, if there's already a `.gitignore` file there\n    if (error.code === 'EEXIST') {\n      let data = fs.readFileSync(path.join(projectRoot, 'gitignore'));\n      fs.appendFileSync(path.join(projectRoot, '.gitignore'), data);\n      fs.unlinkSync(path.join(projectRoot, 'gitignore'));\n    } else if (error.code === 'ENOENT') {\n      // `gitignore` doesn't exist, move on.\n    } else {\n      throw error;\n    }\n  }\n\n  await initGitRepo(projectRoot);\n\n  await installDependencies(projectRoot, packageManager);\n\n  return projectRoot;\n}\n\nasync function initGitRepo(root: string) {\n  if (process.platform === 'darwin' && !Binaries.isXcodeInstalled()) {\n    Logger.global.warn(`Unable to initialize git repo. \\`git\\` not installed.`);\n    return;\n  }\n\n  // let's see if we're in a git tree\n  let insideGit = true;\n  try {\n    await spawnAsync('git', ['rev-parse', '--is-inside-work-tree'], {\n      cwd: root,\n    });\n    Logger.global.debug('New project is already inside of a git repo, skipping git init.');\n  } catch (e) {\n    insideGit = false;\n  }\n\n  if (!insideGit) {\n    try {\n      await spawnAsync('git', ['init'], { cwd: root });\n      Logger.global.info('Initialized a git repository.');\n    } catch (e) {\n      // no-op -- this is just a convenience and we don't care if it fails\n    }\n  }\n}\n\nasync function installDependencies(projectRoot, packageManager) {\n  Logger.global.info('Installing dependencies...');\n\n  if (packageManager === 'yarn') {\n    await spawnAsync('yarnpkg', ['install'], {\n      cwd: projectRoot,\n      stdio: 'inherit',\n    });\n  } else {\n    await spawnAsync('npm', ['install'], {\n      cwd: projectRoot,\n      stdio: 'inherit',\n    });\n  }\n}\n\nexport async function saveRecentExpRootAsync(root: string) {\n  root = path.resolve(root);\n\n  // Write the recent Exps JSON file\n  let recentExpsJsonFile = UserSettings.recentExpsJsonFile();\n  let recentExps = await recentExpsJsonFile.readAsync();\n  // Filter out copies of this so we don't get dupes in this list\n  recentExps = recentExps.filter(function(x) {\n    return x !== root;\n  });\n  recentExps.unshift(root);\n  return await recentExpsJsonFile.writeAsync(recentExps.slice(0, 100));\n}\n\nfunction getHomeDir(): string {\n  return process.env[process.platform === 'win32' ? 'USERPROFILE' : 'HOME'] || '';\n}\n\nfunction makePathReadable(pth) {\n  let homedir = getHomeDir();\n  if (pth.substr(0, homedir.length) === homedir) {\n    return `~${pth.substr(homedir.length)}`;\n  } else {\n    return pth;\n  }\n}\n\nexport async function expInfoSafeAsync(root: string) {\n  try {\n    let {\n      exp: { name, description, icon, iconUrl },\n    } = await ProjectUtils.readConfigJsonAsync(root);\n    let pathOrUrl =\n      icon || iconUrl || 'https://d3lwq5rlu14cro.cloudfront.net/ExponentEmptyManifest_192.png';\n    let resolvedPath = path.resolve(root, pathOrUrl);\n    if (fs.existsSync(resolvedPath)) {\n      icon = `file://${resolvedPath}`;\n    } else {\n      icon = pathOrUrl; // Assume already a URL\n    }\n\n    return {\n      readableRoot: makePathReadable(root),\n      root,\n      name,\n      description,\n      icon,\n    };\n  } catch (e) {\n    return null;\n  }\n}\n\ntype PublishInfo = {\n  args: {\n    username: string,\n    remoteUsername: string,\n    remotePackageName: string,\n    remoteFullPackageName: string,\n    bundleIdentifierIOS: ?string,\n  },\n};\n\nexport async function getThirdPartyInfoAsync(publicUrl: string): Promise<PublishInfo> {\n  const user = await UserManager.ensureLoggedInAsync();\n\n  if (!user) {\n    throw new Error('Attempted to login in offline mode. This is a bug.');\n  }\n\n  const { username } = user;\n\n  const exp = await ThirdParty.getManifest(publicUrl);\n  const { slug, sdkVersion, version } = exp;\n  if (!sdkVersion) {\n    throw new Error(`sdkVersion is missing from ${publicUrl}`);\n  }\n\n  if (!slug) {\n    // slug is made programmatically for app.json\n    throw new Error(`slug field is missing from exp.json.`);\n  }\n\n  if (!version) {\n    throw new Error(`Can't get version of package.`);\n  }\n\n  const bundleIdentifierIOS = exp.ios ? exp.ios.bundleIdentifier : null;\n  return {\n    args: {\n      username,\n      remoteUsername: username,\n      remotePackageName: slug,\n      remoteFullPackageName: `@${username}/${slug}`,\n      bundleIdentifierIOS,\n      sdkVersion,\n    },\n  };\n}\n\n// TODO: remove / change, no longer publishInfo, this is just used for signing\nexport async function getPublishInfoAsync(root: string): Promise<PublishInfo> {\n  const user = await UserManager.ensureLoggedInAsync();\n\n  if (!user) {\n    throw new Error('Attempted to login in offline mode. This is a bug.');\n  }\n\n  const { username } = user;\n\n  const { exp } = await ProjectUtils.readConfigJsonAsync(root);\n\n  const name = exp.slug;\n  const { version, sdkVersion } = exp;\n\n  const configName = await ProjectUtils.configFilenameAsync(root);\n\n  if (!sdkVersion) {\n    throw new Error(`sdkVersion is missing from ${configName}`);\n  }\n\n  if (!name) {\n    // slug is made programmatically for app.json\n    throw new Error(`slug field is missing from exp.json.`);\n  }\n\n  if (!version) {\n    throw new Error(`Can't get version of package.`);\n  }\n\n  const remotePackageName = name;\n  const remoteUsername = username;\n  const remoteFullPackageName = `@${remoteUsername}/${remotePackageName}`;\n  const bundleIdentifierIOS = exp.ios ? exp.ios.bundleIdentifier : null;\n\n  return {\n    args: {\n      username,\n      remoteUsername,\n      remotePackageName,\n      remoteFullPackageName,\n      bundleIdentifierIOS,\n      sdkVersion,\n    },\n  };\n}\n\nexport async function recentValidExpsAsync() {\n  let recentExpsJsonFile = UserSettings.recentExpsJsonFile();\n  let recentExps = await recentExpsJsonFile.readAsync();\n\n  let results = await Promise.all(recentExps.map(expInfoSafeAsync));\n  let filteredResults = results.filter(result => result);\n  return filteredResults;\n}\n\nexport async function sendAsync(recipient: string, url_: string, allowUnauthed: boolean = true) {\n  let result = await Api.callMethodAsync('send', [recipient, url_, allowUnauthed]);\n  return result;\n}\n\n// TODO: figure out where these functions should live\nexport async function getProjectRandomnessAsync(projectRoot: string) {\n  let ps = await ProjectSettings.readAsync(projectRoot);\n  let randomness = ps.urlRandomness;\n  if (randomness) {\n    return randomness;\n  } else {\n    return resetProjectRandomnessAsync(projectRoot);\n  }\n}\n\nexport async function resetProjectRandomnessAsync(projectRoot: string) {\n  let randomness = UrlUtils.someRandomness();\n  ProjectSettings.setAsync(projectRoot, { urlRandomness: randomness });\n  return randomness;\n}\n\nexport async function clearXDLCacheAsync() {\n  let dotExpoHomeDirectory = UserSettings.dotExpoHomeDirectory();\n  rimraf.sync(path.join(dotExpoHomeDirectory, 'ios-simulator-app-cache'));\n  rimraf.sync(path.join(dotExpoHomeDirectory, 'android-apk-cache'));\n  rimraf.sync(path.join(dotExpoHomeDirectory, 'starter-app-cache'));\n  Logger.notifications.info(`Cleared cache`);\n}\n"],"sourceRoot":"/xdl@52.0.12/src"}