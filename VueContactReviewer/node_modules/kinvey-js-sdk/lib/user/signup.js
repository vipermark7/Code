Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var isEmpty_1 = tslib_1.__importDefault(require("lodash/isEmpty"));
var activeUser_1 = require("../errors/activeUser");
var http_1 = require("../http");
var getActiveUser_1 = require("./getActiveUser");
var user_1 = require("./user");
function signup(data, options) {
    if (options === void 0) { options = {}; }
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var activeUser, _a, state, request, response, session;
        return tslib_1.__generator(this, function (_b) {
            switch (_b.label) {
                case 0:
                    activeUser = getActiveUser_1.getActiveUser();
                    _a = options.state, state = _a === void 0 ? true : _a;
                    if (state === true && activeUser) {
                        throw new activeUser_1.ActiveUserError('An active user already exists. Please logout the active user before you signup.');
                    }
                    request = new http_1.KinveyHttpRequest({
                        method: http_1.HttpRequestMethod.POST,
                        auth: http_1.KinveyHttpAuth.App,
                        url: http_1.formatKinveyBaasUrl(http_1.KinveyBaasNamespace.User),
                        timeout: options.timeout
                    });
                    if (data instanceof user_1.User) {
                        request.body = isEmpty_1.default(data.data) ? null : data.data;
                    }
                    else {
                        request.body = isEmpty_1.default(data) ? null : data;
                    }
                    return [4 /*yield*/, request.execute()];
                case 1:
                    response = _b.sent();
                    session = response.data;
                    if (state === true) {
                        http_1.setSession(session);
                    }
                    return [2 /*return*/, new user_1.User(session)];
            }
        });
    });
}
exports.signup = signup;
//# sourceMappingURL=signup.js.map