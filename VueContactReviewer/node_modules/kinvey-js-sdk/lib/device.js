Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var kinvey_1 = require("./kinvey");
var storage_1 = require("./storage");
var COLLECTION_NAME = '_Device';
function s4() {
    return Math.floor((1 + Math.random()) * 0x10000)
        .toString(16)
        .substring(1);
}
function uuidv4() {
    return "" + s4() + s4() + "-" + s4() + "-" + s4() + "-" + s4() + "-" + s4() + s4() + s4();
}
function getDeviceId() {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
        var storage, docs, doc;
        return tslib_1.__generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    storage = new storage_1.Storage(kinvey_1.getAppKey(), COLLECTION_NAME);
                    return [4 /*yield*/, storage.find()];
                case 1:
                    docs = _a.sent();
                    doc = docs.shift();
                    if (!!doc) return [3 /*break*/, 3];
                    return [4 /*yield*/, storage.save({ uuid: uuidv4() })];
                case 2:
                    doc = _a.sent();
                    _a.label = 3;
                case 3: return [2 /*return*/, doc.uuid];
            }
        });
    });
}
exports.getDeviceId = getDeviceId;
//# sourceMappingURL=device.js.map